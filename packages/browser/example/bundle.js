var Aegis=function(t){const e={};function n(){return"process object"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?global:"undefined"!=typeof window?window:e}function o(t,e,n){const o=t[e],r=n(o);if("function"==typeof o)try{!function(t,e){const n=e.prototype||{};t.prototype=e.prototype=n}(r,o)}catch(t){}t[e]=r}var r,s;function c(){return Date.now()}function i(){return n().location.href}!function(t){t[t.JS_ERROR=0]="JS_ERROR"}(r||(r={})),function(t){t[t.UNKNOWN_FUNCTION=0]="UNKNOWN_FUNCTION"}(s||(s={}));const a=["debug","info","warn","error","log","assert","trace"],u=function(){let t=!1;const e={enable(){t=!0},disable(){t=!1}};return a.forEach((n=>{e[n]=(...e)=>{t&&function(t){const e=window.console,n={};a.forEach((t=>n[t]=e[t]));try{t()}finally{Object.keys(n).forEach((t=>{e[t]=n[t]}))}}(global.console[n](`Logger [${n}:]`,...e))}})),e}();function l(t,e){try{t()}catch(t){console.error("err",t),e&&e(t)}}var d;!function(t){t.UNKNOWN="UNKNOWN",t.UNKNOWN_FUNCTION="UNKNOWN_FUNCTION",t.JAVASCRIPT="JAVASCRIPT",t.LOG="LOG",t.HTTP="HTTP",t.VUE="VUE",t.REACT="REACT",t.RESOURCE="RESOURCE",t.PROMISE="PROMISE",t.ROUTE="ROUTE"}(d||(d={}));class f{constructor(){this.dep=new Map}watch(t,e){this.dep.set(t,e)}notify(t,e){const n=this.dep.get(t);n&&n.forEach((t=>{l((()=>{t(e)}),(t=>{u.error("subcribe error: ",t)}))}))}}function h(t){const e=[];function n(t){return e.splice(e.indexOf(t),1)}return{buffer:e,add:function(o){if(!(e.length<t))return new Promise((t=>t(new Error("over rate limits."))));const r=o();return-1==e.indexOf(r)&&e.push(r),r.then((()=>n(r))).then(null,(()=>n(r)))}}}class p{constructor(t){this.options=t}send(t){const{makeRequest:e,requestBuffer:n=h(100)}=this.options;return console.log(t,t.body,999),n.add((()=>e(t).then((t=>{null!=t.statusCode&&(t.statusCode<200||t.statusCode>=300)&&u.warn("fetch error")}),(t=>{u.error("fetch failed",t)}))))}}class y extends class{constructor(t){this.transport=null,this.dsn="",this.options=t,t.dsn&&(this.dsn=t.dsn)}use(t){const e=new f;t.forEach((t=>{t.monitor.call(this,e.notify.bind(e)),e.watch(t.name,((...e)=>{var n,o;const r=null===(n=t.transform)||void 0===n?void 0:n.call(this,e);null===(o=t.consumer)||void 0===o||o.call(this,r)}))}))}}{constructor(t){super(t),this.options=Object.assign({},t);const e={dsn:(o=t.dsn,o.includes("xxx")?"xxx"+o:o)};var o;const r=n();this.transport="function"==typeof r.fetch?function(t,e){return new p({dsn:t.dsn,makeRequest:function(n){const o=Object.assign({body:JSON.stringify(n.body),method:"POST",referrerPolicy:"origin",headers:null==t?void 0:t.headers,keepalive:n.body.length<=65536},t.fetchOptions);return e(t.dsn,o).then((t=>({statusCode:t.status})))}})}(e,r.fetch):function(t){return new p({makeRequest:function(e){return new Promise(((n,o)=>{const r=new XMLHttpRequest;r.onerror=o,r.onreadystatechange=()=>{4===r.readyState&&n({statusCode:r.status})},r.open("POST",(null==t?void 0:t.url)||t.dsn);for(const e in t.headers)Object.prototype.hasOwnProperty.call(t.headers,e)&&r.setRequestHeader(e,t.headers[e]);r.send(e.body)}))},dsn:t.dsn})}(e)}log(t){const{name:e="log",message:n="",type:o="normal",level:r="info"}=t,s={body:{type:o,level:r,message:n,name:e,url:i(),time:c()}};this.transport.send(s)}}const m=n(),O={name:"error",monitor(t){m.addEventListener("error",(e=>{t(e.error)}),!0)},transform:t=>(t.localName,function(t){return{type:d.RESOURCE,url:i(),message:t.src+t.href,level:"low",time:c(),name:t.localName}}(t)),consumer(t){this.transport.send(t)}},N={name:"unhandlerrejection",monitor(t){m.addEventListener("unhandledrejection",(e=>{t(e)}),!0)},transform(t){let e=t;try{e=t.reason}catch(t){}return{type:d.PROMISE,message:e,url:i(),name:t.type,time:c(),level:"low"}},consumer(t){this.transport.send(t)}},E={name:"dom",monitor(t){!function(t,e){const r=n(),s=r[t]&&r[t].prototype;s&&s.hasOwnProperty&&s.hasOwnProperty("addEventListener")&&(o(s,"addEventListener",(function(t){return function(n,o,r){return t.apply(this,[n,()=>{e(n,{category:n,data:this}),function(t){t&&"function"==typeof t&&l(t,(t=>{console.error(t)}))}(o)},r])}})),o(s,"removeEventListener",(function(t){return function(e,n,o){const r=n;try{const n=r;n&&t.call(this,e,n,o)}catch(t){}return t.call(this,e,r,o)}})))}("click",function(t,e){let n=!0;return function(...e){n&&(n=!1,setTimeout((()=>{"function"==typeof t&&t(e),n=!0}),300))}}(t))},transform:t=>t.error,consumer(t){this.transport.send(t)}};return t.BrowserClient=y,t.createInstance=function(t){const e=new y(t),n=[E,O,N];return e.use(n),e},t}({});
//# sourceMappingURL=index.js.map
